<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>1aa573ff664346829b34a9b8a5c333d0</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<section id="project-background" class="cell markdown" id="07ee0dc1">
<h1>Project Background</h1>
<p>This notebook is part of the practical coursework in the <strong>KDD
Course Lab</strong> at the <strong>Arab International University
(AIU)</strong>.</p>
<ul>
<li><strong>Student:</strong> MHD ZAID AL NAHHAS</li>
<li><strong>Instructor:</strong> Eng. RAGHAD ARAB</li>
</ul>
<p>This work extends the analysis from the notebook "<strong>DDoS
Detection using Machine Learning</strong>" by <strong>RAKIB HOSSAIN
SAJIB</strong>, focusing on exploring different encoders and scalers
with the KNN model, and performing more detailed evaluation and
tuning.</p>
<h2 id="dataset-information">Dataset Information</h2>
<p>The dataset used in this notebook is <strong>CIC-DDoS2019</strong>,
an academic intrusion detection dataset available on Kaggle.</p>
<ul>
<li><strong>Original Authors:</strong> Dr. Iman Sharafaldin, Dr. Saqib
Hakak, Dr. Arash Habibi Lashkari, Dr. Ali Ghorbani. (Please cite their
original paper.)</li>
<li><strong>Description:</strong> The dataset contains an extended set
of Distributed Denial of Service attacks, primarily using amplification
through reflection. It shares features with other CIC NIDS datasets
(IDS2017, IDS2018, and DoS2017).</li>
<li><strong>Dataset Versions:</strong>
<ul>
<li><strong>V0:</strong> Base dataset in CSV format.</li>
<li><strong>V1:</strong> CSVs with corrected extreme class imbalance
(attack:benign ratio adjusted to 9:1).</li>
<li><strong>V2:</strong> Cleaned data converted to parquet files.</li>
<li><strong>V3:</strong> Reorganized for storage efficiency, keeping
original CSVs in V1/V2.</li>
</ul></li>
<li><strong>Clean Version (Parquet):</strong> Data types are correctly
set, with no missing information or duplicate records.</li>
<li><strong>Note:</strong> A previous analysis using an ensemble OneR
model achieved a 0.991 AUROC, suggesting the dataset may be relatively
easy to separate malicious from benign traffic globally.</li>
<li><strong>License:</strong> CC BY-NC-SA 4.0</li>
<li><strong>Expected Update Frequency:</strong> Never</li>
<li><strong>Tags:</strong> Internet, Tabular, Research, Cyber Security,
Tabular Classification</li>
<li><strong>File Format:</strong> Available in parquet format, which is
binary, tabular, and optimized for loading with
<code>pd.read_parquet</code> (requires <code>pyarrow</code> or
<code>fastparquet</code>).</li>
</ul>
<h3 id="dataset-files-version-3">Dataset Files (Version 3)</h3>
<p>The dataset consists of 17 parquet files:</p>
<ul>
<li>DNS-testing.parquet</li>
<li>LDAP-testing.parquet</li>
<li>LDAP-training.parquet</li>
<li>MSSQL-testing.parquet</li>
<li>MSSQL-training.parquet</li>
<li>NTP-testing.parquet</li>
<li>NetBIOS-testing.parquet</li>
<li>NetBIOS-training.parquet</li>
<li>Portmap-training.parquet</li>
<li>SNMP-testing.parquet</li>
<li>Syn-testing.parquet</li>
<li>Syn-training.parquet</li>
<li>TFTP-testing.parquet</li>
<li>UDP-testing.parquet</li>
<li>UDP-training.parquet</li>
<li>UDPLag-testing.parquet</li>
<li>UDPLag-training.parquet</li>
</ul>
</section>
<div class="cell code" id="kuzhA2Da26vy">
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> kagglehub</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Download latest version</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> kagglehub.dataset_download(<span class="st">&quot;dhoogla/cicddos2019&quot;</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Path to dataset files:&quot;</span>, path)</span></code></pre></div>
</div>
<section
id="ddos-detection-using-knn-with-different-encoders-and-scalers"
class="cell markdown" id="dJEu6maS248j">
<h1>DDoS Detection using KNN with Different Encoders and Scalers</h1>
<p>This notebook extends the original DDoS detection project by focusing
on the KNN algorithm and exploring different encoding and scaling
techniques to improve model performance.</p>
<h2 id="project-overview">Project Overview</h2>
<p>We'll be using the <strong>CICDDoS2019</strong> dataset to detect and
classify various DDoS attacks. In this notebook, we'll:</p>
<ol>
<li>Define and compare different encoding techniques</li>
<li>Define and compare different scaling techniques</li>
<li>Apply these techniques to the dataset</li>
<li>Train KNN models with different combinations</li>
<li>Evaluate performance using confusion matrices and other metrics</li>
<li>Identify the best encoder/scaler combination for this task</li>
</ol>
</section>
<section id="import-libraries" class="cell markdown" id="Mhuhkuw3248l">
<h2>Import Libraries</h2>
</section>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T11:46:36.427801Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T11:46:36.427417Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T11:46:38.439809Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T11:46:38.438721Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T11:46:36.427771Z&quot;}"
id="ssdNjvKP248l">
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, cross_val_score, GridSearchCV</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder, MinMaxScaler, StandardScaler, RobustScaler, MaxAbsScaler, OneHotEncoder, OrdinalEncoder, QuantileTransformer</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, roc_auc_score, precision_score, recall_score, f1_score, roc_curve, confusion_matrix, classification_report</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">&#39;ignore&#39;</span>)</span></code></pre></div>
</div>
<section id="data-loading" class="cell markdown" id="3w82IcpG248m">
<h2>Data Loading</h2>
<p>We'll use the same data loading process as the original notebook.</p>
</section>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T11:46:38.442017Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T11:46:38.441409Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T11:46:38.517043Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T11:46:38.516074Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T11:46:38.441982Z&quot;}"
id="hnbBGG2S248m" data-outputId="28feefce-fc0d-4a6b-debe-fdbf52733dd2">
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Collecting Training and Testing Dataset File Paths</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>dfps_train <span class="op">=</span> []</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>dfps_test <span class="op">=</span> []</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> dirname, _, filenames <span class="kw">in</span> os.walk(<span class="st">&#39;/kaggle/input/cicddos2019/&#39;</span>):</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> filename <span class="kw">in</span> filenames:</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> filename.endswith(<span class="st">&#39;-training.parquet&#39;</span>):</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>            dfp <span class="op">=</span> os.path.join(dirname, filename)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>            dfps_train.append(dfp)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(dfp)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> filename.endswith(<span class="st">&#39;-testing.parquet&#39;</span>):</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>            dfp <span class="op">=</span> os.path.join(dirname, filename)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>            dfps_test.append(dfp)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(dfp)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>/kaggle/input/cicddos2019/Syn-training.parquet
/kaggle/input/cicddos2019/UDPLag-testing.parquet
/kaggle/input/cicddos2019/NetBIOS-testing.parquet
/kaggle/input/cicddos2019/Portmap-training.parquet
/kaggle/input/cicddos2019/Syn-testing.parquet
/kaggle/input/cicddos2019/MSSQL-testing.parquet
/kaggle/input/cicddos2019/SNMP-testing.parquet
/kaggle/input/cicddos2019/UDPLag-training.parquet
/kaggle/input/cicddos2019/NTP-testing.parquet
/kaggle/input/cicddos2019/LDAP-testing.parquet
/kaggle/input/cicddos2019/UDP-training.parquet
/kaggle/input/cicddos2019/NetBIOS-training.parquet
/kaggle/input/cicddos2019/DNS-testing.parquet
/kaggle/input/cicddos2019/UDP-testing.parquet
/kaggle/input/cicddos2019/LDAP-training.parquet
/kaggle/input/cicddos2019/TFTP-testing.parquet
/kaggle/input/cicddos2019/MSSQL-training.parquet
</code></pre>
</div>
</div>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T11:46:38.518617Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T11:46:38.518273Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T11:46:38.526093Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T11:46:38.524864Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T11:46:38.518587Z&quot;}"
id="ySw-Q8oo248m">
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Common Prefixes in both lists</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>train_prefixes <span class="op">=</span> [dfp.split(<span class="st">&#39;/&#39;</span>)[<span class="op">-</span><span class="dv">1</span>].split(<span class="st">&#39;-&#39;</span>)[<span class="dv">0</span>] <span class="cf">for</span> dfp <span class="kw">in</span> dfps_train]</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>test_prefixes <span class="op">=</span> [dfp.split(<span class="st">&#39;/&#39;</span>)[<span class="op">-</span><span class="dv">1</span>].split(<span class="st">&#39;-&#39;</span>)[<span class="dv">0</span>] <span class="cf">for</span> dfp <span class="kw">in</span> dfps_test]</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>common_prefixes <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(train_prefixes).intersection(test_prefixes))</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the dataframes to only include the common prefixes</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>dfps_train <span class="op">=</span> [dfp <span class="cf">for</span> dfp <span class="kw">in</span> dfps_train <span class="cf">if</span> dfp.split(<span class="st">&#39;/&#39;</span>)[<span class="op">-</span><span class="dv">1</span>].split(<span class="st">&#39;-&#39;</span>)[<span class="dv">0</span>] <span class="kw">in</span> common_prefixes]</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>dfps_test <span class="op">=</span> [dfp <span class="cf">for</span> dfp <span class="kw">in</span> dfps_test <span class="cf">if</span> dfp.split(<span class="st">&#39;/&#39;</span>)[<span class="op">-</span><span class="dv">1</span>].split(<span class="st">&#39;-&#39;</span>)[<span class="dv">0</span>] <span class="kw">in</span> common_prefixes]</span></code></pre></div>
</div>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T11:46:38.528879Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T11:46:38.528522Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T11:46:39.371008Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T11:46:39.370017Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T11:46:38.528854Z&quot;}"
id="1TOxUAjr248n">
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>train_df <span class="op">=</span> pd.concat([pd.read_parquet(dfp) <span class="cf">for</span> dfp <span class="kw">in</span> dfps_train], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>test_df <span class="op">=</span> pd.concat([pd.read_parquet(dfp) <span class="cf">for</span> dfp <span class="kw">in</span> dfps_test], ignore_index<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
</div>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T11:46:39.372406Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T11:46:39.372166Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T11:46:39.380491Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T11:46:39.379275Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T11:46:39.372387Z&quot;}"
id="g2wE26Xl248n" data-outputId="0dd47a61-2f6c-40b4-f1c5-80eb72a37300">
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>train_df.shape, test_df.shape</span></code></pre></div>
<div class="output execute_result" data-execution_count="5">
<pre><code>((120065, 78), (38973, 78))</code></pre>
</div>
</div>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T11:46:39.381944Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T11:46:39.381589Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T11:46:39.417542Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T11:46:39.416506Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T11:46:39.381912Z&quot;}"
id="LgJRsyaL248n" data-outputId="3c9a4b86-1833-4a8e-b6f3-260e501a83a3">
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the target distribution of the training data</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>train_df[<span class="st">&quot;Label&quot;</span>].value_counts()</span></code></pre></div>
<div class="output execute_result" data-execution_count="6">
<pre><code>Label
Syn        48840
Benign     42007
UDP        18090
MSSQL       8523
LDAP        1906
NetBIOS      644
UDPLag        55
Name: count, dtype: int64</code></pre>
</div>
</div>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T11:46:39.419316Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T11:46:39.418925Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T11:46:39.440121Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T11:46:39.439137Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T11:46:39.419268Z&quot;}"
id="Y25guJvZ248n" data-outputId="93bfd6a2-111f-4267-87a2-8f1f4381e54a">
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the target distribution of the testing data</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>test_df[<span class="st">&quot;Label&quot;</span>].value_counts()</span></code></pre></div>
<div class="output execute_result" data-execution_count="7">
<pre><code>Label
Benign           10847
DrDoS_UDP        10420
UDP-lag           8872
DrDoS_MSSQL       6212
DrDoS_LDAP        1440
DrDoS_NetBIOS      598
Syn                533
WebDDoS             51
Name: count, dtype: int64</code></pre>
</div>
</div>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T11:46:39.441486Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T11:46:39.441162Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T11:46:39.490334Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T11:46:39.489522Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T11:46:39.441449Z&quot;}"
id="MmWS1MQH248n">
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop the WebDDoS class from the testing data if it exists</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">&#39;WebDDoS&#39;</span> <span class="kw">in</span> test_df[<span class="st">&quot;Label&quot;</span>].unique():</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    test_df <span class="op">=</span> test_df[test_df[<span class="st">&quot;Label&quot;</span>] <span class="op">!=</span> <span class="st">&quot;WebDDoS&quot;</span>]</span></code></pre></div>
</div>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T11:46:39.491942Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T11:46:39.491579Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T11:46:39.509857Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T11:46:39.508807Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T11:46:39.491905Z&quot;}"
id="WFRLbdd0248n">
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Map the target values in the testing data to match the training data</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>label_mapping <span class="op">=</span> {</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;DrDoS_UDP&#39;</span>: <span class="st">&#39;UDP&#39;</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;UDP-lag&#39;</span>: <span class="st">&#39;UDPLag&#39;</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;DrDoS_MSSQL&#39;</span>: <span class="st">&#39;MSSQL&#39;</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;DrDoS_LDAP&#39;</span>: <span class="st">&#39;LDAP&#39;</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;DrDoS_NetBIOS&#39;</span>: <span class="st">&#39;NetBIOS&#39;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>test_df[<span class="st">&#39;Label&#39;</span>] <span class="op">=</span> test_df[<span class="st">&#39;Label&#39;</span>].replace(label_mapping)</span></code></pre></div>
</div>
<section id="data-preprocessing" class="cell markdown"
id="6vbUffdB248n">
<h2>Data Preprocessing</h2>
<p>We'll follow the same preprocessing steps as the original notebook,
including removing single unique value columns and highly correlated
columns.</p>
</section>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T11:46:39.512958Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T11:46:39.512623Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T11:46:39.950963Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T11:46:39.949822Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T11:46:39.512936Z&quot;}"
id="swx3AVO_248n">
<div class="sourceCode" id="cb15"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove columns with a single unique value</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> train_df.columns:</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> train_df[col].nunique() <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>        train_df.drop(col, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> col <span class="kw">in</span> test_df.columns:</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>            test_df.drop(col, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
</div>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T11:46:39.952305Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T11:46:39.952052Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T11:46:41.467210Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T11:46:41.466098Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T11:46:39.952287Z&quot;}"
id="dWXlRYiu248o">
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate correlation matrix</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>corr_matrix <span class="op">=</span> train_df.drop(<span class="st">&#39;Label&#39;</span>, axis<span class="op">=</span><span class="dv">1</span>).corr().<span class="bu">abs</span>()</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Select upper triangle of correlation matrix</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>upper <span class="op">=</span> corr_matrix.where(np.triu(np.ones(corr_matrix.shape), k<span class="op">=</span><span class="dv">1</span>).astype(<span class="bu">bool</span>))</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Find features with correlation greater than 0.8</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>to_drop <span class="op">=</span> [column <span class="cf">for</span> column <span class="kw">in</span> upper.columns <span class="cf">if</span> <span class="bu">any</span>(upper[column] <span class="op">&gt;</span> <span class="fl">0.8</span>)]</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop highly correlated features</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>train_df.drop(to_drop, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>test_df.drop(to_drop, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
</div>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T11:46:41.468566Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T11:46:41.468286Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T11:46:41.522157Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T11:46:41.521131Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T11:46:41.468544Z&quot;}"
id="Ygw72G-u248o">
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data into features and target</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>X_train, X_val, y_train, y_val <span class="op">=</span> train_test_split(train_df.drop(<span class="st">&quot;Label&quot;</span>, axis<span class="op">=</span><span class="dv">1</span>), train_df[<span class="st">&quot;Label&quot;</span>], test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>X_test, y_test <span class="op">=</span> test_df.drop(<span class="st">&quot;Label&quot;</span>, axis<span class="op">=</span><span class="dv">1</span>), test_df[<span class="st">&quot;Label&quot;</span>]</span></code></pre></div>
</div>
<section id="defining-different-encoders-and-scalers"
class="cell markdown" id="sJvkvqey248o">
<h2>Defining Different Encoders and Scalers</h2>
<p>In this section, we'll define various encoding and scaling techniques
that we'll use to preprocess our data before training the KNN model.</p>
</section>
<section id="target-encoders" class="cell markdown" id="bmvQwTLk248o">
<h3>Target Encoders</h3>
<p>These encoders will be used to transform the categorical target
variable (attack types) into numerical values.</p>
</section>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T11:46:41.524779Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T11:46:41.523739Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T11:46:41.530112Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T11:46:41.529006Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T11:46:41.524725Z&quot;}"
id="Q0eg9Js7248o">
<div class="sourceCode" id="cb18"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define different target encoders</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>encoders <span class="op">=</span> {</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;LabelEncoder&#39;</span>: LabelEncoder(),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;OrdinalEncoder&#39;</span>: OrdinalEncoder(),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;OneHotEncoder&#39;</span>: OneHotEncoder(sparse_output<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="cell markdown" id="yDXUpSMZ248o">
<h3 id="target-encoders">Target Encoders</h3>
<p>These encoders will be used to transform the categorical target
variable (attack types) into numerical values.</p>
<h2 id="1-labelencoder">1. LabelEncoder</h2>
<ul>
<li><strong>Description</strong>: Encodes target labels with values
between 0 and <code>n_classes-1</code>.</li>
<li><strong>Use Case</strong>: For binary or multi-class classification
where the order of classes doesn't matter.</li>
<li><strong>Advantages</strong>: Simple and efficient.</li>
<li><strong>Disadvantages</strong>: Introduces an artificial ordinal
relationship between classes, which can be problematic for some
models.</li>
<li><strong>Suitability for DDoS Detection</strong>: Can be used for
multi-class DDoS classification, but be mindful of the induced
ordinality.</li>
</ul>
<h2 id="2-ordinalencoder">2. OrdinalEncoder</h2>
<ul>
<li><strong>Description</strong>: Encodes categorical features as an
integer array.</li>
<li><strong>Use Case</strong>: For categorical features where the order
matters (ordinal data).</li>
<li><strong>Advantages</strong>: Preserves ordinal relationships if they
exist.</li>
<li><strong>Disadvantages</strong>: Requires knowing the order of
categories beforehand.</li>
<li><strong>Suitability for DDoS Detection</strong>: Less suitable for
the target variable (attack types) as there's no inherent order, but
could be used for other ordinal features if present.</li>
</ul>
<h2 id="3-onehotencoder">3. OneHotEncoder</h2>
<ul>
<li><strong>Description</strong>: Encodes categorical features as a
one-hot numeric array.</li>
<li><strong>Use Case</strong>: When the categorical feature has no
ordinal relationship and you want to avoid the issues of
LabelEncoder.</li>
<li><strong>Advantages</strong>: Does not introduce artificial
ordinality.</li>
<li><strong>Disadvantages</strong>: Can result in a large number of
features, especially with high-cardinality categorical features.</li>
<li><strong>Suitability for DDoS Detection</strong>: A good choice for
the target variable to avoid ordinality issues, but will create a column
for each attack type.</li>
</ul>
</div>
<section id="feature-scalers" class="cell markdown" id="WsRVENjt248o">
<h3>Feature Scalers</h3>
<p>These scalers will be used to normalize the feature values, which is
particularly important for distance-based algorithms like KNN.</p>
</section>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T11:46:41.531533Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T11:46:41.531275Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T11:46:41.549194Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T11:46:41.547939Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T11:46:41.531509Z&quot;}"
id="qOjD4pRL248o">
<div class="sourceCode" id="cb19"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define different feature scalers</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>scalers <span class="op">=</span> {</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;MinMaxScaler&#39;</span>: MinMaxScaler(),</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;StandardScaler&#39;</span>: StandardScaler(),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;RobustScaler&#39;</span>: RobustScaler(),</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;MaxAbsScaler&#39;</span>: MaxAbsScaler(),</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;QuantileTransformer&#39;</span>: QuantileTransformer(output_distribution<span class="op">=</span><span class="st">&#39;normal&#39;</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="cell markdown" id="6IKqrBpl248o">
<h2>1. MinMaxScaler</h2>
<ul>
<li><strong>Description</strong>: Scales features to a given range, usually [0,1].</li>
<li><strong>Use Case</strong>: When you need bounded values and the distribution doesn't matter much.</li>
<li><strong>Advantages</strong>: Preserves the shape of the original distribution, handles sparse data well.</li>
<li><strong>Disadvantages</strong>: Sensitive to outliers.</li>
<li><strong>Suitability for DDoS Detection</strong>: Works well for <code>KNN</code> which is sensitive to feature magnitude.</li>
</ul>
<h2>2. StandardScaler</h2>
<ul>
<li><strong>Description</strong>: Standardizes features by removing the mean and scaling to unit variance.</li>
<li><strong>Use Case</strong>: When you need normally distributed features.</li>
<li><strong>Advantages</strong>: Less affected by outliers than <code>MinMaxScaler</code>, works well with algorithms assuming normal distribution.</li>
<li><strong>Disadvantages</strong>: Does not guarantee a bounded range for features.</li>
<li><strong>Suitability for DDoS Detection</strong>: Good for network traffic features that might follow a normal distribution.</li>
</ul>
<h2>3. RobustScaler</h2>
<ul>
<li><strong>Description</strong>: Uses statistics that are robust to outliers (median and quantiles).</li>
<li><strong>Use Case</strong>: When your data contains many outliers.</li>
<li><strong>Advantages</strong>: Robust to outliers, preserves useful information in outliers without letting them dominate.</li>
<li><strong>Disadvantages</strong>: May not scale data as compactly as other methods.</li>
<li><strong>Suitability for DDoS Detection</strong>: Potentially very useful for network traffic data which often contains outliers.</li>
</ul>
<h2>4. MaxAbsScaler</h2>
<ul>
<li><strong>Description</strong>: Scales by the maximum absolute value.</li>
<li><strong>Use Case</strong>: When dealing with sparse data.</li>
<li><strong>Advantages</strong>: Preserves sparsity, does not shift/center data.</li>
<li><strong>Disadvantages</strong>: Sensitive to outliers.</li>
<li><strong>Suitability for DDoS Detection</strong>: Useful if network traffic features contain many zeros.</li>
</ul>
</div>
<section id="applying-different-encoders-and-scalers"
class="cell markdown" id="ZFaBgZ3X248o">
<h2>Applying Different Encoders and Scalers</h2>
<p>Now we'll apply the different encoders to the target variable and
different scalers to the features.</p>
</section>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T11:46:41.551731Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T11:46:41.551457Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T11:46:41.569337Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T11:46:41.568093Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T11:46:41.551713Z&quot;}"
id="lEGSgWQ_248o">
<div class="sourceCode" id="cb20"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to encode target variables with different encoders</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> encode_target(y_train, y_val, y_test, encoder_name):</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    encoder <span class="op">=</span> encoders[encoder_name]</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> encoder_name <span class="op">==</span> <span class="st">&#39;OneHotEncoder&#39;</span>:</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reshape for OneHotEncoder which expects 2D input</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>        y_train_encoded <span class="op">=</span> encoder.fit_transform(y_train.values.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        y_val_encoded <span class="op">=</span> encoder.transform(y_val.values.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>        y_test_encoded <span class="op">=</span> encoder.transform(y_test.values.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># For OneHotEncoder, we need to return the encoder classes for later use</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> y_train_encoded, y_val_encoded, y_test_encoded, encoder.categories_[<span class="dv">0</span>]</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> encoder_name <span class="op">==</span> <span class="st">&#39;OrdinalEncoder&#39;</span>:</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reshape for OrdinalEncoder which expects 2D input</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>        y_train_encoded <span class="op">=</span> encoder.fit_transform(y_train.values.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)).ravel()</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>        y_val_encoded <span class="op">=</span> encoder.transform(y_val.values.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)).ravel()</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>        y_test_encoded <span class="op">=</span> encoder.transform(y_test.values.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)).ravel()</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># For OrdinalEncoder, we need to return the encoder categories for later use</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> y_train_encoded, y_val_encoded, y_test_encoded, encoder.categories_[<span class="dv">0</span>]</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:  <span class="co"># LabelEncoder</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>        y_train_encoded <span class="op">=</span> encoder.fit_transform(y_train)</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>        y_val_encoded <span class="op">=</span> encoder.transform(y_val)</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>        y_test_encoded <span class="op">=</span> encoder.transform(y_test)</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># For LabelEncoder, we need to return the encoder classes for later use</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> y_train_encoded, y_val_encoded, y_test_encoded, encoder.classes_</span></code></pre></div>
</div>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T11:46:41.570616Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T11:46:41.570380Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T11:46:41.591243Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T11:46:41.590037Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T11:46:41.570599Z&quot;}"
id="76E1YiDK248o">
<div class="sourceCode" id="cb21"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to scale features with different scalers</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> scale_features(X_train, X_val, X_test, scaler_name):</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    scaler <span class="op">=</span> scalers[scaler_name]</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    X_train_scaled <span class="op">=</span> scaler.fit_transform(X_train)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    X_val_scaled <span class="op">=</span> scaler.transform(X_val)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    X_test_scaled <span class="op">=</span> scaler.transform(X_test)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> X_train_scaled, X_val_scaled, X_test_scaled</span></code></pre></div>
</div>
<section
id="training-knn-models-with-different-encoder-scaler-combinations"
class="cell markdown" id="IWfSW-ML248o">
<h2>Training KNN Models with Different Encoder-Scaler Combinations</h2>
<p>Now we'll train KNN models using different combinations of encoders
and scalers to find the best performing combination.</p>
</section>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T11:46:41.592486Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T11:46:41.592241Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T11:46:41.604425Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T11:46:41.603317Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T11:46:41.592467Z&quot;}"
id="dDaxuG33248p">
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to train and evaluate KNN model</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_evaluate_knn(X_train_scaled, X_val_scaled, y_train_encoded, y_val_encoded, encoder_name, scaler_name, classes):</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize KNN model</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    knn <span class="op">=</span> KNeighborsClassifier(n_neighbors<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Train the model</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    knn.fit(X_train_scaled, y_train_encoded)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make predictions</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> knn.predict(X_val_scaled)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate metrics</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> encoder_name <span class="op">==</span> <span class="st">&#39;OneHotEncoder&#39;</span>:</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># For OneHotEncoder, we need to convert predictions back to class indices</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>        y_val_indices <span class="op">=</span> np.argmax(y_val_encoded, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>        y_pred_indices <span class="op">=</span> np.argmax(y_pred, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>        accuracy <span class="op">=</span> accuracy_score(y_val_indices, y_pred_indices)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>        precision <span class="op">=</span> precision_score(y_val_indices, y_pred_indices, average<span class="op">=</span><span class="st">&#39;weighted&#39;</span>, zero_division<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>        recall <span class="op">=</span> recall_score(y_val_indices, y_pred_indices, average<span class="op">=</span><span class="st">&#39;weighted&#39;</span>, zero_division<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>        f1 <span class="op">=</span> f1_score(y_val_indices, y_pred_indices, average<span class="op">=</span><span class="st">&#39;weighted&#39;</span>, zero_division<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create confusion matrix</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>        cm <span class="op">=</span> confusion_matrix(y_val_indices, y_pred_indices)</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>        accuracy <span class="op">=</span> accuracy_score(y_val_encoded, y_pred)</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>        precision <span class="op">=</span> precision_score(y_val_encoded, y_pred, average<span class="op">=</span><span class="st">&#39;weighted&#39;</span>, zero_division<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>        recall <span class="op">=</span> recall_score(y_val_encoded, y_pred, average<span class="op">=</span><span class="st">&#39;weighted&#39;</span>, zero_division<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>        f1 <span class="op">=</span> f1_score(y_val_encoded, y_pred, average<span class="op">=</span><span class="st">&#39;weighted&#39;</span>, zero_division<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create confusion matrix</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>        cm <span class="op">=</span> confusion_matrix(y_val_encoded, y_pred)</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return results</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;encoder&#39;</span>: encoder_name,</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;scaler&#39;</span>: scaler_name,</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;accuracy&#39;</span>: accuracy,</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;precision&#39;</span>: precision,</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;recall&#39;</span>: recall,</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;f1&#39;</span>: f1,</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;model&#39;</span>: knn,</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;confusion_matrix&#39;</span>: cm,</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;classes&#39;</span>: classes</span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>    }</span></code></pre></div>
</div>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T11:46:41.605901Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T11:46:41.605551Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T11:47:53.083776Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T11:47:53.082397Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T11:46:41.605870Z&quot;}"
id="m2QfG0tl248p" data-outputId="1e536b7e-bb77-4f96-e9d9-8ef87a637073">
<div class="sourceCode" id="cb23"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train models with all combinations of encoders and scalers</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> encoder_name <span class="kw">in</span> encoders.keys():</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Skip OneHotEncoder for now as it requires special handling</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> encoder_name <span class="op">==</span> <span class="st">&#39;OneHotEncoder&#39;</span>:</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Encode target variables</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    y_train_encoded, y_val_encoded, y_test_encoded, classes <span class="op">=</span> encode_target(y_train, y_val, y_test, encoder_name)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> scaler_name <span class="kw">in</span> scalers.keys():</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Training KNN with </span><span class="sc">{</span>encoder_name<span class="sc">}</span><span class="ss"> and </span><span class="sc">{</span>scaler_name<span class="sc">}</span><span class="ss">...&quot;</span>)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Scale features</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>        X_train_scaled, X_val_scaled, X_test_scaled <span class="op">=</span> scale_features(X_train, X_val, X_test, scaler_name)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Train and evaluate model</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> train_evaluate_knn(X_train_scaled, X_val_scaled, y_train_encoded, y_val_encoded, encoder_name, scaler_name, classes)</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>        results.append(result)</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Accuracy: </span><span class="sc">{</span>result[<span class="st">&#39;accuracy&#39;</span>]<span class="sc">:.4f}</span><span class="ss">, F1 Score: </span><span class="sc">{</span>result[<span class="st">&#39;f1&#39;</span>]<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Training KNN with LabelEncoder and MinMaxScaler...
Accuracy: 0.9886, F1 Score: 0.9886
Training KNN with LabelEncoder and StandardScaler...
Accuracy: 0.9885, F1 Score: 0.9885
Training KNN with LabelEncoder and RobustScaler...
Accuracy: 0.9734, F1 Score: 0.9734
Training KNN with LabelEncoder and MaxAbsScaler...
Accuracy: 0.9885, F1 Score: 0.9885
Training KNN with LabelEncoder and QuantileTransformer...
Accuracy: 0.9869, F1 Score: 0.9869
Training KNN with OrdinalEncoder and MinMaxScaler...
Accuracy: 0.9886, F1 Score: 0.9886
Training KNN with OrdinalEncoder and StandardScaler...
Accuracy: 0.9885, F1 Score: 0.9885
Training KNN with OrdinalEncoder and RobustScaler...
Accuracy: 0.9734, F1 Score: 0.9734
Training KNN with OrdinalEncoder and MaxAbsScaler...
Accuracy: 0.9885, F1 Score: 0.9885
Training KNN with OrdinalEncoder and QuantileTransformer...
Accuracy: 0.9868, F1 Score: 0.9868
</code></pre>
</div>
</div>
<section id="analyzing-results" class="cell markdown" id="NYdzOO8o248p">
<h2>Analyzing Results</h2>
<p>Now we'll analyze the results to find the best encoder-scaler
combination.</p>
</section>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T11:47:53.085169Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T11:47:53.084845Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T11:47:53.207408Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T11:47:53.206220Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T11:47:53.085139Z&quot;}"
id="JBbEeCDm248p" data-outputId="a6835e3e-dbfc-46f7-988f-2fefd74a8f69">
<div class="sourceCode" id="cb25"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame with the results</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>results_df <span class="op">=</span> pd.DataFrame([{</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Encoder&#39;</span>: r[<span class="st">&#39;encoder&#39;</span>],</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Scaler&#39;</span>: r[<span class="st">&#39;scaler&#39;</span>],</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Accuracy&#39;</span>: r[<span class="st">&#39;accuracy&#39;</span>],</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Precision&#39;</span>: r[<span class="st">&#39;precision&#39;</span>],</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Recall&#39;</span>: r[<span class="st">&#39;recall&#39;</span>],</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;F1 Score&#39;</span>: r[<span class="st">&#39;f1&#39;</span>]</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>} <span class="cf">for</span> r <span class="kw">in</span> results])</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the results</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>display(results_df.style.background_gradient(cmap<span class="op">=</span><span class="st">&#39;viridis&#39;</span>))</span></code></pre></div>
<div class="output display_data">
<style type="text/css">
#T_7d2eb_row0_col2, #T_7d2eb_row0_col3, #T_7d2eb_row0_col4, #T_7d2eb_row0_col5, #T_7d2eb_row1_col3, #T_7d2eb_row3_col2, #T_7d2eb_row3_col4, #T_7d2eb_row5_col2, #T_7d2eb_row5_col3, #T_7d2eb_row5_col4, #T_7d2eb_row5_col5, #T_7d2eb_row6_col3, #T_7d2eb_row8_col2, #T_7d2eb_row8_col4 {
  background-color: #fde725;
  color: #000000;
}
#T_7d2eb_row1_col2, #T_7d2eb_row1_col4, #T_7d2eb_row1_col5, #T_7d2eb_row3_col5, #T_7d2eb_row6_col2, #T_7d2eb_row6_col4, #T_7d2eb_row6_col5, #T_7d2eb_row8_col5 {
  background-color: #fbe723;
  color: #000000;
}
#T_7d2eb_row2_col2, #T_7d2eb_row2_col3, #T_7d2eb_row2_col4, #T_7d2eb_row2_col5, #T_7d2eb_row7_col2, #T_7d2eb_row7_col3, #T_7d2eb_row7_col4, #T_7d2eb_row7_col5 {
  background-color: #440154;
  color: #f1f1f1;
}
#T_7d2eb_row3_col3, #T_7d2eb_row8_col3 {
  background-color: #f8e621;
  color: #000000;
}
#T_7d2eb_row4_col2, #T_7d2eb_row4_col4, #T_7d2eb_row4_col5 {
  background-color: #b5de2b;
  color: #000000;
}
#T_7d2eb_row4_col3 {
  background-color: #bade28;
  color: #000000;
}
#T_7d2eb_row9_col2, #T_7d2eb_row9_col4, #T_7d2eb_row9_col5 {
  background-color: #b2dd2d;
  color: #000000;
}
#T_7d2eb_row9_col3 {
  background-color: #b8de29;
  color: #000000;
}
</style>
<table id="T_7d2eb">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_7d2eb_level0_col0" class="col_heading level0 col0" >Encoder</th>
      <th id="T_7d2eb_level0_col1" class="col_heading level0 col1" >Scaler</th>
      <th id="T_7d2eb_level0_col2" class="col_heading level0 col2" >Accuracy</th>
      <th id="T_7d2eb_level0_col3" class="col_heading level0 col3" >Precision</th>
      <th id="T_7d2eb_level0_col4" class="col_heading level0 col4" >Recall</th>
      <th id="T_7d2eb_level0_col5" class="col_heading level0 col5" >F1 Score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_7d2eb_level0_row0" class="row_heading level0 row0" >0</th>
      <td id="T_7d2eb_row0_col0" class="data row0 col0" >LabelEncoder</td>
      <td id="T_7d2eb_row0_col1" class="data row0 col1" >MinMaxScaler</td>
      <td id="T_7d2eb_row0_col2" class="data row0 col2" >0.988590</td>
      <td id="T_7d2eb_row0_col3" class="data row0 col3" >0.988653</td>
      <td id="T_7d2eb_row0_col4" class="data row0 col4" >0.988590</td>
      <td id="T_7d2eb_row0_col5" class="data row0 col5" >0.988573</td>
    </tr>
    <tr>
      <th id="T_7d2eb_level0_row1" class="row_heading level0 row1" >1</th>
      <td id="T_7d2eb_row1_col0" class="data row1 col0" >LabelEncoder</td>
      <td id="T_7d2eb_row1_col1" class="data row1 col1" >StandardScaler</td>
      <td id="T_7d2eb_row1_col2" class="data row1 col2" >0.988506</td>
      <td id="T_7d2eb_row1_col3" class="data row1 col3" >0.988605</td>
      <td id="T_7d2eb_row1_col4" class="data row1 col4" >0.988506</td>
      <td id="T_7d2eb_row1_col5" class="data row1 col5" >0.988505</td>
    </tr>
    <tr>
      <th id="T_7d2eb_level0_row2" class="row_heading level0 row2" >2</th>
      <td id="T_7d2eb_row2_col0" class="data row2 col0" >LabelEncoder</td>
      <td id="T_7d2eb_row2_col1" class="data row2 col1" >RobustScaler</td>
      <td id="T_7d2eb_row2_col2" class="data row2 col2" >0.973431</td>
      <td id="T_7d2eb_row2_col3" class="data row2 col3" >0.973513</td>
      <td id="T_7d2eb_row2_col4" class="data row2 col4" >0.973431</td>
      <td id="T_7d2eb_row2_col5" class="data row2 col5" >0.973363</td>
    </tr>
    <tr>
      <th id="T_7d2eb_level0_row3" class="row_heading level0 row3" >3</th>
      <td id="T_7d2eb_row3_col0" class="data row3 col0" >LabelEncoder</td>
      <td id="T_7d2eb_row3_col1" class="data row3 col1" >MaxAbsScaler</td>
      <td id="T_7d2eb_row3_col2" class="data row3 col2" >0.988548</td>
      <td id="T_7d2eb_row3_col3" class="data row3 col3" >0.988526</td>
      <td id="T_7d2eb_row3_col4" class="data row3 col4" >0.988548</td>
      <td id="T_7d2eb_row3_col5" class="data row3 col5" >0.988496</td>
    </tr>
    <tr>
      <th id="T_7d2eb_level0_row4" class="row_heading level0 row4" >4</th>
      <td id="T_7d2eb_row4_col0" class="data row4 col0" >LabelEncoder</td>
      <td id="T_7d2eb_row4_col1" class="data row4 col1" >QuantileTransformer</td>
      <td id="T_7d2eb_row4_col2" class="data row4 col2" >0.986882</td>
      <td id="T_7d2eb_row4_col3" class="data row4 col3" >0.987058</td>
      <td id="T_7d2eb_row4_col4" class="data row4 col4" >0.986882</td>
      <td id="T_7d2eb_row4_col5" class="data row4 col5" >0.986875</td>
    </tr>
    <tr>
      <th id="T_7d2eb_level0_row5" class="row_heading level0 row5" >5</th>
      <td id="T_7d2eb_row5_col0" class="data row5 col0" >OrdinalEncoder</td>
      <td id="T_7d2eb_row5_col1" class="data row5 col1" >MinMaxScaler</td>
      <td id="T_7d2eb_row5_col2" class="data row5 col2" >0.988590</td>
      <td id="T_7d2eb_row5_col3" class="data row5 col3" >0.988653</td>
      <td id="T_7d2eb_row5_col4" class="data row5 col4" >0.988590</td>
      <td id="T_7d2eb_row5_col5" class="data row5 col5" >0.988573</td>
    </tr>
    <tr>
      <th id="T_7d2eb_level0_row6" class="row_heading level0 row6" >6</th>
      <td id="T_7d2eb_row6_col0" class="data row6 col0" >OrdinalEncoder</td>
      <td id="T_7d2eb_row6_col1" class="data row6 col1" >StandardScaler</td>
      <td id="T_7d2eb_row6_col2" class="data row6 col2" >0.988506</td>
      <td id="T_7d2eb_row6_col3" class="data row6 col3" >0.988605</td>
      <td id="T_7d2eb_row6_col4" class="data row6 col4" >0.988506</td>
      <td id="T_7d2eb_row6_col5" class="data row6 col5" >0.988505</td>
    </tr>
    <tr>
      <th id="T_7d2eb_level0_row7" class="row_heading level0 row7" >7</th>
      <td id="T_7d2eb_row7_col0" class="data row7 col0" >OrdinalEncoder</td>
      <td id="T_7d2eb_row7_col1" class="data row7 col1" >RobustScaler</td>
      <td id="T_7d2eb_row7_col2" class="data row7 col2" >0.973431</td>
      <td id="T_7d2eb_row7_col3" class="data row7 col3" >0.973513</td>
      <td id="T_7d2eb_row7_col4" class="data row7 col4" >0.973431</td>
      <td id="T_7d2eb_row7_col5" class="data row7 col5" >0.973363</td>
    </tr>
    <tr>
      <th id="T_7d2eb_level0_row8" class="row_heading level0 row8" >8</th>
      <td id="T_7d2eb_row8_col0" class="data row8 col0" >OrdinalEncoder</td>
      <td id="T_7d2eb_row8_col1" class="data row8 col1" >MaxAbsScaler</td>
      <td id="T_7d2eb_row8_col2" class="data row8 col2" >0.988548</td>
      <td id="T_7d2eb_row8_col3" class="data row8 col3" >0.988526</td>
      <td id="T_7d2eb_row8_col4" class="data row8 col4" >0.988548</td>
      <td id="T_7d2eb_row8_col5" class="data row8 col5" >0.988496</td>
    </tr>
    <tr>
      <th id="T_7d2eb_level0_row9" class="row_heading level0 row9" >9</th>
      <td id="T_7d2eb_row9_col0" class="data row9 col0" >OrdinalEncoder</td>
      <td id="T_7d2eb_row9_col1" class="data row9 col1" >QuantileTransformer</td>
      <td id="T_7d2eb_row9_col2" class="data row9 col2" >0.986840</td>
      <td id="T_7d2eb_row9_col3" class="data row9 col3" >0.987042</td>
      <td id="T_7d2eb_row9_col4" class="data row9 col4" >0.986840</td>
      <td id="T_7d2eb_row9_col5" class="data row9 col5" >0.986842</td>
    </tr>
  </tbody>
</table>

</div>
</div>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T11:47:53.209082Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T11:47:53.208581Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T11:47:53.215498Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T11:47:53.214234Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T11:47:53.209057Z&quot;}"
id="xRSspgze248p" data-outputId="cf55362d-5179-403d-a229-26067974f221">
<div class="sourceCode" id="cb26"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the best combination based on F1 score</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>best_result <span class="op">=</span> <span class="bu">max</span>(results, key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">&#39;f1&#39;</span>])</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Best encoder-scaler combination: </span><span class="sc">{</span>best_result[<span class="st">&#39;encoder&#39;</span>]<span class="sc">}</span><span class="ss"> + </span><span class="sc">{</span>best_result[<span class="st">&#39;scaler&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Accuracy: </span><span class="sc">{</span>best_result[<span class="st">&#39;accuracy&#39;</span>]<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Precision: </span><span class="sc">{</span>best_result[<span class="st">&#39;precision&#39;</span>]<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Recall: </span><span class="sc">{</span>best_result[<span class="st">&#39;recall&#39;</span>]<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;F1 Score: </span><span class="sc">{</span>best_result[<span class="st">&#39;f1&#39;</span>]<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Best encoder-scaler combination: LabelEncoder + MinMaxScaler
Accuracy: 0.9886
Precision: 0.9887
Recall: 0.9886
F1 Score: 0.9886
</code></pre>
</div>
</div>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T11:47:53.217055Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T11:47:53.216738Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T11:47:53.657157Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T11:47:53.656079Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T11:47:53.217033Z&quot;}"
id="-rQSKazA248p" data-outputId="9c300021-a4a7-47b7-857a-dc48636c4951">
<div class="sourceCode" id="cb28"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot confusion matrix for the best model</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>sns.heatmap(best_result[<span class="st">&#39;confusion_matrix&#39;</span>], annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">&#39;d&#39;</span>, cmap<span class="op">=</span><span class="st">&#39;Blues&#39;</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>            xticklabels<span class="op">=</span>best_result[<span class="st">&#39;classes&#39;</span>], yticklabels<span class="op">=</span>best_result[<span class="st">&#39;classes&#39;</span>])</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;Confusion Matrix - </span><span class="sc">{</span>best_result[<span class="st">&#39;encoder&#39;</span>]<span class="sc">}</span><span class="ss"> + </span><span class="sc">{</span>best_result[<span class="st">&#39;scaler&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Predicted&#39;</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;True&#39;</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_41e9ba6e7c2c4e359fde8d20979a2c28/2d3e6dff79e8555e75b7bd1e6c96482d53055a2c.png" /></p>
</div>
</div>
<section id="optimizing-the-best-model" class="cell markdown"
id="tIve-YxN248p">
<h2>Optimizing the Best Model</h2>
<p>Now that we've found the best encoder-scaler combination, let's
optimize the KNN model by tuning its hyperparameters.</p>
</section>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T11:47:53.658549Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T11:47:53.658216Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T12:18:21.172355Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T12:18:21.171210Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T11:47:53.658525Z&quot;}"
id="PUcgMxTm248p" data-outputId="ebef0036-d36d-452f-b101-4ade00746d26">
<div class="sourceCode" id="cb29"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the best encoder and scaler</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>best_encoder <span class="op">=</span> best_result[<span class="st">&#39;encoder&#39;</span>]</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>best_scaler <span class="op">=</span> best_result[<span class="st">&#39;scaler&#39;</span>]</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-encode and scale with the best combination</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>y_train_encoded, y_val_encoded, y_test_encoded, classes <span class="op">=</span> encode_target(y_train, y_val, y_test, best_encoder)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>X_train_scaled, X_val_scaled, X_test_scaled <span class="op">=</span> scale_features(X_train, X_val, X_test, best_scaler)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Define parameter grid for KNN</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;n_neighbors&#39;</span>: [<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>],</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;weights&#39;</span>: [<span class="st">&#39;uniform&#39;</span>, <span class="st">&#39;distance&#39;</span>],</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;metric&#39;</span>: [<span class="st">&#39;euclidean&#39;</span>, <span class="st">&#39;manhattan&#39;</span>, <span class="st">&#39;minkowski&#39;</span>]</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create GridSearchCV</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>grid_search <span class="op">=</span> GridSearchCV(</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    KNeighborsClassifier(),</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    param_grid,</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    cv<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    scoring<span class="op">=</span><span class="st">&#39;f1_weighted&#39;</span>,</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>    n_jobs<span class="op">=-</span><span class="dv">1</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit GridSearchCV</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>grid_search.fit(X_train_scaled, y_train_encoded)</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Get best parameters</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Best parameters:&quot;</span>, grid_search.best_params_)</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Best cross-validation score:&quot;</span>, grid_search.best_score_)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Best parameters: {&#39;metric&#39;: &#39;euclidean&#39;, &#39;n_neighbors&#39;: 7, &#39;weights&#39;: &#39;distance&#39;}
Best cross-validation score: 0.9920862970391104
</code></pre>
</div>
</div>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T12:18:21.175516Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T12:18:21.175208Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T12:18:27.223105Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T12:18:27.221960Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T12:18:21.175491Z&quot;}"
id="dvXVvi7a248p" data-outputId="2a728e38-124b-4e9e-cd81-81a935c3fa8f">
<div class="sourceCode" id="cb31"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train final model with best parameters</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>best_knn <span class="op">=</span> grid_search.best_estimator_</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>best_knn.fit(X_train_scaled, y_train_encoded)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate on validation set</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>y_val_pred <span class="op">=</span> best_knn.predict(X_val_scaled)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate metrics</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> accuracy_score(y_val_encoded, y_val_pred)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>precision <span class="op">=</span> precision_score(y_val_encoded, y_val_pred, average<span class="op">=</span><span class="st">&#39;weighted&#39;</span>, zero_division<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>recall <span class="op">=</span> recall_score(y_val_encoded, y_val_pred, average<span class="op">=</span><span class="st">&#39;weighted&#39;</span>, zero_division<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>f1 <span class="op">=</span> f1_score(y_val_encoded, y_val_pred, average<span class="op">=</span><span class="st">&#39;weighted&#39;</span>, zero_division<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Optimized KNN with </span><span class="sc">{</span>best_encoder<span class="sc">}</span><span class="ss"> and </span><span class="sc">{</span>best_scaler<span class="sc">}</span><span class="ss">:&quot;</span>)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Accuracy: </span><span class="sc">{</span>accuracy<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Precision: </span><span class="sc">{</span>precision<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Recall: </span><span class="sc">{</span>recall<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;F1 Score: </span><span class="sc">{</span>f1<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Optimized KNN with LabelEncoder and MinMaxScaler:
Accuracy: 0.9915
Precision: 0.9915
Recall: 0.9915
F1 Score: 0.9915
</code></pre>
</div>
</div>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T12:18:27.224602Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T12:18:27.224358Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T12:18:27.568605Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T12:18:27.567673Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T12:18:27.224583Z&quot;}"
id="i62HkWsG248q" data-outputId="678ef35f-3cd1-4aa4-d6d7-e98c576bf4d8">
<div class="sourceCode" id="cb33"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create confusion matrix for the optimized model</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_matrix(y_val_encoded, y_val_pred)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>sns.heatmap(cm, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">&#39;d&#39;</span>, cmap<span class="op">=</span><span class="st">&#39;Blues&#39;</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>            xticklabels<span class="op">=</span>classes, yticklabels<span class="op">=</span>classes)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;Confusion Matrix - Optimized KNN with </span><span class="sc">{</span>best_encoder<span class="sc">}</span><span class="ss"> and </span><span class="sc">{</span>best_scaler<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Predicted&#39;</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;True&#39;</span>)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_41e9ba6e7c2c4e359fde8d20979a2c28/b5fa727729e893897e658a6c76319394657a1956.png" /></p>
</div>
</div>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T12:20:41.017719Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T12:20:41.017336Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T12:20:41.067183Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T12:20:41.066159Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T12:20:41.017692Z&quot;}"
id="jeum0y-o248q" data-outputId="f538d44d-31eb-4003-e7e4-bcbe9b907450">
<div class="sourceCode" id="cb34"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate classification report</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Classification Report:&quot;</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_val_encoded, y_val_pred, target_names<span class="op">=</span>classes))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Classification Report:
              precision    recall  f1-score   support

      Benign       1.00      1.00      1.00      8316
        LDAP       0.92      0.96      0.94       376
       MSSQL       0.94      0.96      0.95      1694
     NetBIOS       0.95      0.98      0.97       127
         Syn       1.00      1.00      1.00      9934
         UDP       0.99      0.98      0.98      3556
      UDPLag       0.29      0.20      0.24        10

    accuracy                           0.99     24013
   macro avg       0.87      0.87      0.87     24013
weighted avg       0.99      0.99      0.99     24013

</code></pre>
</div>
</div>
<section id="final-evaluation-on-test-set" class="cell markdown"
id="cBxNxHDl248q">
<h2>Final Evaluation on Test Set</h2>
<p>Now let's evaluate our optimized model on the test set to get a final
assessment of its performance.</p>
</section>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T12:21:00.853885Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T12:21:00.852691Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T12:21:10.427007Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T12:21:10.425858Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T12:21:00.853836Z&quot;}"
id="kjeOTw6i248q" data-outputId="b125835f-c522-4c72-cbef-3c3b8162602b">
<div class="sourceCode" id="cb36"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate on test set</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>y_test_pred <span class="op">=</span> best_knn.predict(X_test_scaled)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate metrics</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> accuracy_score(y_test_encoded, y_test_pred)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>precision <span class="op">=</span> precision_score(y_test_encoded, y_test_pred, average<span class="op">=</span><span class="st">&#39;weighted&#39;</span>, zero_division<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>recall <span class="op">=</span> recall_score(y_test_encoded, y_test_pred, average<span class="op">=</span><span class="st">&#39;weighted&#39;</span>, zero_division<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>f1 <span class="op">=</span> f1_score(y_test_encoded, y_test_pred, average<span class="op">=</span><span class="st">&#39;weighted&#39;</span>, zero_division<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Final Test Results - Optimized KNN with </span><span class="sc">{</span>best_encoder<span class="sc">}</span><span class="ss"> and </span><span class="sc">{</span>best_scaler<span class="sc">}</span><span class="ss">:&quot;</span>)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Accuracy: </span><span class="sc">{</span>accuracy<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Precision: </span><span class="sc">{</span>precision<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Recall: </span><span class="sc">{</span>recall<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;F1 Score: </span><span class="sc">{</span>f1<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Final Test Results - Optimized KNN with LabelEncoder and MinMaxScaler:
Accuracy: 0.7471
Precision: 0.9231
Recall: 0.7471
F1 Score: 0.7135
</code></pre>
</div>
</div>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T12:21:22.334366Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T12:21:22.333631Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T12:21:22.692515Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T12:21:22.691339Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T12:21:22.334330Z&quot;}"
id="gqitt6k9248q" data-outputId="38d7d995-632f-4184-c8ad-d892012393dd">
<div class="sourceCode" id="cb38"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create confusion matrix for the test set</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_matrix(y_test_encoded, y_test_pred)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>sns.heatmap(cm, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">&#39;d&#39;</span>, cmap<span class="op">=</span><span class="st">&#39;Blues&#39;</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>            xticklabels<span class="op">=</span>classes, yticklabels<span class="op">=</span>classes)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;Test Set Confusion Matrix - Optimized KNN with </span><span class="sc">{</span>best_encoder<span class="sc">}</span><span class="ss"> and </span><span class="sc">{</span>best_scaler<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Predicted&#39;</span>)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;True&#39;</span>)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_41e9ba6e7c2c4e359fde8d20979a2c28/64caf4e3a3a1dcbc642645280c3fa3367df09618.png" /></p>
</div>
</div>
<div class="cell code"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-07-27T12:21:22.694636Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-07-27T12:21:22.694284Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-07-27T12:21:22.743830Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-07-27T12:21:22.742942Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-07-27T12:21:22.694613Z&quot;}"
id="9Qqxw-D4248q" data-outputId="d6b53d8f-da63-4857-906e-e5f933f4fb2e">
<div class="sourceCode" id="cb39"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate classification report for test set</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Test Set Classification Report:&quot;</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test_encoded, y_test_pred, target_names<span class="op">=</span>classes))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Test Set Classification Report:
              precision    recall  f1-score   support

      Benign       1.00      0.98      0.99     10847
        LDAP       0.85      0.96      0.91      1440
       MSSQL       0.94      0.95      0.95      6212
     NetBIOS       0.99      0.68      0.81       598
         Syn       0.07      1.00      0.13       533
         UDP       0.82      0.98      0.89     10420
      UDPLag       1.00      0.00      0.00      8872

    accuracy                           0.75     38922
   macro avg       0.81      0.79      0.67     38922
weighted avg       0.92      0.75      0.71     38922

</code></pre>
</div>
</div>
<section id="conclusion" class="cell markdown" id="Kko1PzOU248q">
<h2>Conclusion</h2>
<p>In this notebook, we explored different encoding and scaling
techniques for DDoS attack detection using KNN. We found that the best
combination was <strong>LabelEncoder</strong> with
<strong>MinMaxScaler</strong>, which achieved an F1 score of
<strong>0.9915</strong> on the validation set and
<strong>0.7135</strong> on the test set.</p>
<p>The optimized KNN model with parameters
<code>{'metric': 'euclidean', 'n_neighbors': 7, 'weights': 'distance'}</code>
performed well on the validation set, but showed a significant drop in
performance on the test set, particularly for minority classes like
'UDPLag' and 'Syn'.</p>
<p>Key findings:</p>
<ol>
<li><strong>Encoder comparison insights</strong>: LabelEncoder and
OrdinalEncoder performed similarly well in combination with most
scalers. OneHotEncoder was not evaluated in this run.</li>
<li><strong>Scaler comparison insights</strong>: MinMaxScaler,
StandardScaler, and MaxAbsScaler yielded the highest F1 scores when
combined with LabelEncoder or OrdinalEncoder. RobustScaler and
QuantileTransformer resulted in lower F1 scores.</li>
<li><strong>KNN parameter tuning insights</strong>: The grid search
found that <code>n_neighbors=7</code>, <code>weights='distance'</code>,
and <code>metric='euclidean'</code> were the best parameters for the KNN
model with LabelEncoder and MinMaxScaler.</li>
<li><strong>Class-specific performance insights</strong>: The optimized
model shows excellent performance on the 'Benign', 'LDAP', 'MSSQL', and
'UDP' classes on the test set. However, it struggles significantly with
the 'NetBIOS', 'Syn', and 'UDPLag' classes, indicating potential issues
with data imbalance or the representation of these attack types in the
dataset.</li>
</ol>
<p>This analysis demonstrates the importance of proper data
preprocessing and highlights the challenges of detecting all types of
DDoS attacks, especially those with limited samples. Further
investigation into handling imbalanced datasets and potentially using
different models or feature engineering techniques is recommended to
improve performance on minority classes.</p>
</section>
<div class="cell code" id="0g5Y_oW882QU">
<div class="sourceCode" id="cb41"><pre
class="sourceCode python"><code class="sourceCode python"></code></pre></div>
</div>
</body>
</html>
